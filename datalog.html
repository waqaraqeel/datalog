<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual documents Datalog version 2.6, a lightweight
deductive database system.

Copyright (C) 2004 The MITRE Corporation.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.  The terms are contained in the
file COPYING.LIB in the source distribution of the software, or
at http://www.gnu.org/licenses/lgpl.txt. -->
<!-- Created by GNU Texinfo 6.0, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Datalog User Manual</title>

<meta name="description" content="Datalog User Manual">
<meta name="keywords" content="Datalog User Manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#Top" rel="start" title="Top">
<link href="#Index" rel="index" title="Index">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space: nowrap}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: serif; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<h1 class="settitle" align="center">Datalog User Manual</h1>









<a name="Top"></a>
<div class="header">
<p>
Next: <a href="#Introduction" accesskey="n" rel="next">Introduction</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<p>This manual documents Datalog version 2.6, a lightweight
deductive database system.
</p>
<p>Copyright &copy; 2004 The MITRE Corporation.
</p>
<blockquote>
<p>Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Lesser General Public License as published
by the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.  The terms are contained in the
file <samp>COPYING.LIB</samp> in the source distribution of the software, or
at <a href="http://www.gnu.org/licenses/lgpl.txt">http://www.gnu.org/licenses/lgpl.txt</a>.
</p></blockquote>

<a name="Contents"></a>
<h1 class="top">Contents</h1>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction" accesskey="1">Introduction</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Why <code>datalog</code>?
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Tutorial" accesskey="2">Tutorial</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">A quick start.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Interpreter" accesskey="3">Interpreter</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Invoking and using.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Primitives" accesskey="4">Primitives</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Predicates implemented by code.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Syntax" accesskey="5">Syntax</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Some language details.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Import_002fExport" accesskey="6">Import/Export</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Using tab separated values.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Extensions" accesskey="7">Extensions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Adding primitive predicates.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Stand_002dAlone" accesskey="8">Stand-Alone</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Using the Datalog module in Lua.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Library" accesskey="9">Library</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Embedding the Datalog interpreter.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Copying">Copying</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Terms for copying the software.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Index">Index</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">A concept index.
</td></tr>
</table>

<p>The software described in this manual was written by John D. Ramsdell
of The MITRE Corporation.  The work was supported by the
MITRE-Sponsored Research Program.
</p>
<hr>
<a name="Introduction"></a>
<div class="header">
<p>
Next: <a href="#Tutorial" accesskey="n" rel="next">Tutorial</a>, Previous: <a href="#Top" accesskey="p" rel="prev">Top</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Introduction-1"></a>
<h2 class="chapter">1 Introduction</h2>

<p>The Datalog package contains a lightweight deductive database system.
Queries and database updates are expressed using Datalog&mdash;a
declarative logic language in which each formula is a function-free
Horn clause, and every variable in the head of a clause must appear in
the body of the clause.  The use of Datalog syntax and an
implementation based on tabling intermediate results, ensures that all
queries terminate.
</p>
<p>The components in this package are designed to be small, and usable on
memory constrained devices.  The package includes an interactive
interpreter for Datalog, and a library that can be employed to embed a
small deductive database into C programs.  The library uses the tabled
logic programming algorithm described in &ldquo;Efficient Top-Down
Computation of Queries under the Well-Founded Semantics&rdquo;, Chen, W.,
Swift, T., and Warren, D. S., <cite>J. Logic Prog.</cite>, Vol. 24, No. 3,
Sep. 1995, pp. 161-199.  Another important reference is &ldquo;Tabled
Evaluation with Delaying for General Logic Programs&rdquo;, Chen, W., and
Warren, D. S., <cite>J. ACM</cite>, Vol. 43, No. 1, Jan. 1996, pp. 20-74.
Datalog is described in &ldquo;What You Always Wanted to Know About Datalog
(And Never Dared to Ask)&rdquo;, Stefano Ceri, Georg Gottlob, and Letizia
Tanca, <cite>IEEE Transactions of Knowledge and Data Engineering</cite>,
Vol. 1, No. 1, March 1989.
</p>
<hr>
<a name="Tutorial"></a>
<div class="header">
<p>
Next: <a href="#Interpreter" accesskey="n" rel="next">Interpreter</a>, Previous: <a href="#Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Tutorial-1"></a>
<h2 class="chapter">2 Tutorial</h2>

<p>Datalog is introduced by showing a sequence of interactions with a
Datalog interpreter.  The interpreter is started with the
<code>datalog</code> command.
</p>
<div class="example">
<pre class="example">$ datalog
Datalog 2.6

&gt;
</pre></div>

<a name="index-fact_002c-example"></a>
<p>Facts are stored in tables.  If the name of the table is
&lsquo;<samp>parent</samp>&rsquo;, and &lsquo;<samp>john</samp>&rsquo; is the parent of &lsquo;<samp>douglas</samp>&rsquo;, store
the fact in the database with this:
</p>
<div class="example">
<pre class="example">&gt; parent(john, douglas).
</pre></div>

<a name="index-term"></a>
<p>Each item in the parenthesized list following the name of the table is
called a <em>term</em>.  A term can be either a logical variable or a
constant.  Thus far, all the terms shown have been constant terms.
</p>
<a name="index-query"></a>
<p>A query can be used to see if a particular row is in a table.  Type
this to see if &lsquo;<samp>john</samp>&rsquo; is the parent of &lsquo;<samp>douglas</samp>&rsquo;:
</p>
<div class="example">
<pre class="example">&gt; parent(john, douglas)?
parent(john, douglas).
</pre></div>

<p>Type this to see if &lsquo;<samp>john</samp>&rsquo; is the parent of &lsquo;<samp>ebbon</samp>&rsquo;:
</p>
<div class="example">
<pre class="example">&gt; parent(john, ebbon)?
</pre></div>

<p>The query produced no results because &lsquo;<samp>john</samp>&rsquo; is not the parent of
&lsquo;<samp>ebbon</samp>&rsquo;.  Let&rsquo;s add more rows.
</p>
<div class="example">
<pre class="example">&gt; parent(bob, john).
&gt; parent(ebbon, bob).
</pre></div>

<p>Type the following to list all rows in the &lsquo;<samp>parent</samp>&rsquo; table:
</p>
<div class="example">
<pre class="example">&gt; parent(A, B)?
parent(john, douglas).
parent(bob, john).
parent(ebbon, bob).
</pre></div>

<p>Type the following to list all the children of &lsquo;<samp>john</samp>&rsquo;:
</p>
<div class="example">
<pre class="example">&gt; parent(john, B)?
parent(john, douglas).
</pre></div>

<a name="index-variable"></a>
<p>A term that begins with a capital letter is a logical <em>variable</em>.
When producing a set of answers, the Datalog interpreter lists all
rows that match the query when each variable in the query is
substituted for a constant.  The following example produces no
answers, as there are no substitutions for the variable &lsquo;<samp>A</samp>&rsquo; that
produce a fact in the database.  This is because no one is the parent
of oneself.
</p>
<div class="example">
<pre class="example">&gt; parent(A, A)?
</pre></div>

<a name="index-rule_002c-example"></a>
<p>A deductive database can use rules of inference to derive new facts.
Consider the following rule:
</p>
<div class="example">
<pre class="example">&gt; ancestor(A, B) :- parent(A, B).
</pre></div>

<p>The rule says that if <var>A</var> is the parent of <var>B</var>, then <var>A</var>
is an ancestor of <var>B</var>.  The other rule defining an ancestor says
that if <var>A</var> is the parent of <var>C</var>, <var>C</var> is an ancestor of
<var>B</var>, then <var>A</var> is an ancestor of <var>B</var>.
</p>
<div class="example">
<pre class="example">&gt; ancestor(A, B) :- \
&gt;&gt;   parent(A, C),  \
&gt;&gt;   ancestor(C, B).
</pre></div>

<a name="index-continuation-line_002c-interpreter"></a>
<p>In the interpreter, a line can be continued by ending it with the
backslash character.
</p>
<p>Rules are used to answer queries just as is done for facts.
</p>
<div class="example">
<pre class="example">&gt; ancestor(A, B)?
ancestor(ebbon, bob).
ancestor(ebbon, douglas).
ancestor(bob, john).
ancestor(john, douglas).
ancestor(ebbon, john).
ancestor(bob, douglas).
&gt; ancestor(X,john)?
ancestor(bob, john).
ancestor(ebbon, john).
</pre></div>

<p>A fact or a rule can be retracted from the database using tilde
syntax:
</p>
<a name="index-retraction_002c-example"></a>
<div class="example">
<pre class="example">&gt; parent(bob, john)~
&gt; parent(A,B)?
parent(john, douglas).
parent(ebbon, bob).
&gt; ancestor(A,B)?
ancestor(john, douglas).
ancestor(ebbon, bob).
</pre></div>

<p>Unlike Prolog, the order in which clauses are asserted is irrelevant.
All queries terminate, and every possible answer is derived.
</p>
<a name="index-clause-order_002c-example"></a>
<div class="example">
<pre class="example">&gt; q(X) :- p(X).
&gt; q(a).
&gt; p(X) :- q(X).
&gt; q(X)?
q(a).
</pre></div>

<hr>
<a name="Interpreter"></a>
<div class="header">
<p>
Next: <a href="#Primitives" accesskey="n" rel="next">Primitives</a>, Previous: <a href="#Tutorial" accesskey="p" rel="prev">Tutorial</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Interpreter-1"></a>
<h2 class="chapter">3 Interpreter</h2>

<p>The <code>datalog</code> program provides access to a deductive database
in both interactive or batch mode.  In batch mode, the program reads a
Datalog program, prints the answers to its query, and then exits.  In
interactive mode, the program treats each line of text it reads as a
Datalog program, prints the answer to its query, and then prompts for
more input.
</p>
<p>The <code>datalog</code> interpreter accepts the following options:
</p>
<div class="example">
<pre class="example">$ datalog -h
Usage: datalog [options] [file]
Options:
  -o file -- output to file (default is standard output)
  -i      -- enter interactive mode after loading file
  -l file -- load extensions written in Lua
  -t      -- print output as tab separated values
  -v      -- print version information
  -h      -- print this message
Use - as a file name to specify standard input
</pre></div>

<a name="index-file-loading_002c-interpreter"></a>
<a name="index-equals-sign_002c-interpreter"></a>
<a name="index-continuation-line_002c-interpreter-1"></a>
<p>When in interactive mode, if the first character of a line of input is
the equals sign, the remaining text on the line is used as the name of
a file that is loaded into the interpreter.  An incomplete line of
text can be continued by ending the line with the backslash character.
</p>
<hr>
<a name="Primitives"></a>
<div class="header">
<p>
Next: <a href="#Syntax" accesskey="n" rel="next">Syntax</a>, Previous: <a href="#Interpreter" accesskey="p" rel="prev">Interpreter</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Primitive-Predicates"></a>
<h2 class="chapter">4 Primitive Predicates</h2>

<a name="index-equals-sign_002c-primitive-predicate"></a>
<p>The interpreter provides an equality predicate with infix notation.
Two terms are equal if both terms are the same constant, or one is a
constant and the other is a variable.
</p>
<div class="example">
<pre class="example">&gt; 1 = 2?
&gt; 1 = 1?
1 = 1.
&gt; X = 1?
1 = 1.
&gt; X = X?
</pre></div>

<hr>
<a name="Syntax"></a>
<div class="header">
<p>
Next: <a href="#Import_002fExport" accesskey="n" rel="next">Import/Export</a>, Previous: <a href="#Primitives" accesskey="p" rel="prev">Primitives</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Syntax-1"></a>
<h2 class="chapter">5 Syntax</h2>

<a name="index-comment-syntax"></a>
<a name="index-whitespace"></a>
<p>In Datalog input, whitespace characters are ignored except when they
separate adjacent tokens or when they occur in strings.  Comments are
also considered to be whitespace.  The character &lsquo;<samp>%</samp>&rsquo; introduces a
comment, which extends to the next line break.  Comments do not occur
inside strings.
</p>
<a name="index-token-classes"></a>
<a name="index-punctuations_002c-token-class"></a>
<p>The characters in Datalog input are collected into tokens according to
the rules that follow.  There are four classes of tokens:
punctuations, variables, identifiers, and strings.  The punctuation
tokens are: &lsquo;<samp>(</samp>&rsquo;, &lsquo;<samp>,</samp>&rsquo;, &lsquo;<samp>)</samp>&rsquo;, &lsquo;<samp>=</samp>&rsquo;, &lsquo;<samp>:-</samp>&rsquo;,
&lsquo;<samp>.</samp>&rsquo;, &lsquo;<samp>~</samp>&rsquo;, &lsquo;<samp>?</samp>&rsquo;, and &lsquo;<samp>&quot;</samp>&rsquo;.
</p>
<a name="index-variables_002c-token-class"></a>
<p>A variable is a sequence of Latin capital and small letters, digits,
and the underscore character.  A variable must begin with a Latin
capital letter.
</p>
<a name="index-identifiers_002c-token-class"></a>
<p>An identifier is a sequence of printing characters that does not
contain any of the following characters: &lsquo;<samp>(</samp>&rsquo;, &lsquo;<samp>,</samp>&rsquo;, &lsquo;<samp>)</samp>&rsquo;,
&lsquo;<samp>=</samp>&rsquo;, &lsquo;<samp>:</samp>&rsquo;, &lsquo;<samp>.</samp>&rsquo;, &lsquo;<samp>~</samp>&rsquo;, &lsquo;<samp>?</samp>&rsquo;, &lsquo;<samp>&quot;</samp>&rsquo;, &lsquo;<samp>%</samp>&rsquo;,
and space.  An identifier must not begin with a Latin capital letter.
Note that the characters that start punctuation are forbidden in
identifiers, but the hyphen character is allowed.
</p>
<a name="index-strings_002c-token-class"></a>
<p>A string is a sequence of characters enclosed in double quotes.
Characters other than double quote, newline, and backslash can be
directly included in a string.  The remaining characters can be
specified using escape characters, &lsquo;<samp>\&quot;</samp>&rsquo;, &lsquo;<samp>\n</samp>&rsquo;, and &lsquo;<samp>\\</samp>&rsquo;
respectively.
</p>
<p>Other escape characters can be used to improve the readability of the
input.  If a string is too long to fit conveniently on one line, all
but the final line containing the string can be ended with a backslash
character, and each backslash newline pair is ignored.  The character
escape codes from the C programming language are allowed&mdash;&lsquo;<samp>\a</samp>&rsquo;,
&lsquo;<samp>\b</samp>&rsquo;, &lsquo;<samp>\f</samp>&rsquo;, &lsquo;<samp>\n</samp>&rsquo;, &lsquo;<samp>\r</samp>&rsquo;, &lsquo;<samp>\t</samp>&rsquo;, &lsquo;<samp>\v</samp>&rsquo;,
&lsquo;<samp>\'</samp>&rsquo;, and &lsquo;<samp>\?</samp>&rsquo;.  The numeric escape codes consist of one,
two, or three octal digits.  Thus the ASCII character newline is
&lsquo;<samp>\012</samp>&rsquo;, and zero is &lsquo;<samp>\000</samp>&rsquo;.  A printed Datalog string is
also a string constant in C.
</p>
<a name="Literals"></a>
<h3 class="section">5.1 Literals</h3>
<a name="index-literal"></a>

<a name="index-atomic-formula"></a>
<a name="index-predicate-symbol"></a>
<a name="index-constant"></a>
<p>A <em>literal</em>, is a predicate symbol followed by an optional
parenthesized list of comma separated terms.  A <em>predicate symbol</em>
is either an identifier or a string.  A term is either a variable or a
constant.  As with predicate symbols, a <em>constant</em> is either an
identifier or a string.  The following are literals:
</p>
<div class="example">
<pre class="example">parent(john, douglas)
zero-arity-literal
aBcD(-0, &quot;\n\377&quot;)
&quot;=&quot;(3,3)
&quot;&quot;(-0-0-0,&amp;&amp;&amp;,***,&quot;\0&quot;)
</pre></div>

<a name="Clauses"></a>
<h3 class="section">5.2 Clauses</h3>
<a name="index-clause"></a>

<a name="index-fact"></a>
<a name="index-rule"></a>
<a name="index-head"></a>
<a name="index-body"></a>
<a name="index-safe"></a>
<p>A <em>clause</em> is a <em>head</em> literal followed by an optional body.
A <em>body</em> is a comma separated list of literals.  A clause without
a body is called a <em>fact</em>, and a <em>rule</em> when it has one.  The
punctuation &lsquo;<samp>:-</samp>&rsquo; separates the head of a rule from its body.  A
clause is <em>safe</em> if every variable in its head occurs in some
literal in its body.  The following are safe clauses:
</p>
<div class="example">
<pre class="example">parent(john, douglas)
ancestor(A, B) :-
    parent(A, B)
ancestor(A, B) :-
    parent(A, C),
    ancestor(C, B)
</pre></div>

<a name="Programs"></a>
<h3 class="section">5.3 Programs</h3>
<a name="index-program"></a>

<a name="index-assertion"></a>
<a name="index-retraction"></a>
<a name="index-reader"></a>
<p>A Datalog reader consumes a Datalog program.  A <em>program</em> is a
sequence of zero or more statements, followed by an optional query.  A
statement is an assertion or a retraction.  An <em>assertion</em> is a
clause followed by a period, and it adds the clause to the database if
it is safe.  A <em>retraction</em> is a clause followed by a tilde, and
it removes the clause from the database.  A <em>query</em> is a literal
followed by a question mark.  The effect of reading a Datalog program
is to modify the database as directed by its statements, and then to
return the literal designated as the query.  If no query is specified,
a reader returns a literal know to have no answers.  The following is
a program:
</p>
<div class="example">
<pre class="example">edge(a, b). edge(b, c). edge(c, d). edge(d, a).
path(X, Y) :- edge(X, Y).
path(X, Y) :- edge(X, Z), path(Z, Y).
path(X, Y)?
</pre></div>

<hr>
<a name="Import_002fExport"></a>
<div class="header">
<p>
Next: <a href="#Extensions" accesskey="n" rel="next">Extensions</a>, Previous: <a href="#Syntax" accesskey="p" rel="prev">Syntax</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Import_002fExport-1"></a>
<h2 class="chapter">6 Import/Export</h2>

<a name="index-tab-separated-values"></a>

<p>Tab separated values is a simple text format for a database table.
Each record in the table is one line of text.  Fields within the
record are separated by the tab character.  The script below
translates a file of tab separated values into Datalog syntax.
</p>
<div class="example">
<pre class="example">#! /bin/sh
sed 's/\\/\\\\/g;s/&quot;/\\&quot;/g' -- &quot;$@&quot; | awk -F'\t' '
{
    if (NF == 0)
        print &quot;data().&quot;
    else {
        printf(&quot;data(\&quot;%s\&quot;&quot;, $1)
        for (i = 2; i &lt;= NF; i++)
            printf(&quot;, \&quot;%s\&quot;&quot;, $i)
        print &quot;).&quot;
    }
}'
</pre></div>

<p>The &lsquo;<samp>-t</samp>&rsquo; option causes the <code>datalog</code> program to print
answers to queries as tab separated values.  The following script
removes quoting introduced by <code>datalog</code>.
</p>
<div class="example">
<pre class="example">#! /bin/sh
sed 's/&quot;\([^\t]*\)&quot;/\1/g' -- &quot;$@&quot; | awk '
BEGIN { print &quot;BEGIN {&quot; }
{ print &quot;print \&quot;&quot;$0&quot;\&quot;&quot; }
END { print &quot;}&quot; }' | awk -f -
</pre></div>

<p>An example using <samp>/etc/passwd</samp> as a database table follows.  The
example shows a convoluted way of determining my home directory, but
never the less demonstrates the integration of <code>datalog</code> with
other Unix tools.  In this example, assume the Datalog import script
above has been placed into the file <code>datalogimport</code>.
</p>
<div class="example">
<pre class="example">sed 's/:/\t/g' /etc/passwd \
| datalogimport \
| sed '
$a\home(A,F):-data(A,B,C,D,E,F,G).\
home(ramsdell,Dir)?' \
| datalog -t - \
| sed 's/\t/:/g'
</pre></div>

<p>The first <code>sed</code> command converts <samp>/etc/passwd</samp> to tab
separated values, the second <code>sed</code> command adds a rule and a
query to the Datalog program, and the last <code>sed</code> command
converts the output to colon separated values.  On my machine, the
above script produces <code>ramsdell:/home/ramsdell</code>.
</p>
<p>Notice that input to <code>datalog</code> is obtained from <code>sed</code>
using the &lsquo;<samp>-</samp>&rsquo; option rather than implicitly via standard input.
Using the &lsquo;<samp>-</samp>&rsquo; option avoids prompt printing and other features of
the interactive loop.
</p>
<hr>
<a name="Extensions"></a>
<div class="header">
<p>
Next: <a href="#Stand_002dAlone" accesskey="n" rel="next">Stand-Alone</a>, Previous: <a href="#Import_002fExport" accesskey="p" rel="prev">Import/Export</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Extensions-1"></a>
<h2 class="chapter">7 Extensions</h2>

<a name="index-Lua"></a>
<p>Adding primitive predicates to the Datalog interpreter requires
knowledge of its internals.  Much of the functionality of the
interpreter is implemented using an embedded language called Lua,
available at <a href="http://www.lua.org">http://www.lua.org</a>.  Lua provides the needed
infrastructure and a small footprint.  As an added bonus, the Lua
language is a gem.  Knowledge of Lua is a prerequisite for what
follows.
</p>
<p>The mechanics of adding primitives is straightforward.  Put your
extensions in a file and load it using the &lsquo;<samp>-l</samp>&rsquo; option.
The more difficult part is to decide what code should be
loaded.
</p>
<p>The source file for the Datalog specific Lua code is installed in the
Datalog package&rsquo;s data directory.  The path name of the source file
typically ends with <samp>share/datalog/datalog.lua</samp>.  The section
with a comment containing the words &ldquo;PRIMITIVES&rdquo; is relevant.
</p>
<a name="index-add_005fiter_005fprim_002c-datalog-function"></a>
<a name="index-datalog_002c-Lua-module"></a>
<p>There is good support for the case in which a primitive can be defined
in terms of a Lua iterator.  The file <samp>datalog.lua</samp> defines the
<code>datalog</code> module, and it contains the function
<code>add_iter_prim</code>.  This function defines a primitive when given a
predicate symbol, its arity, and an iterator.
</p>
<p>When given a literal, the iterator generates a sequences of answers.
Each answer must be an array.  Each element in the array must be
either a number or a string.  The length of the array must be equal to
the arity of the predicate.
</p>
<p>What follows is a predicate defined by an iterator that produces one
answer, and the answer has one element in it&mdash;the number three.
</p>
<a name="index-three_002c-primitive"></a>
<div class="example">
<pre class="example">local function all_threes(literal)
  return function (s, v)
    if v then
      return nil
    else
      return {3}
    end
end
datalog.add_iter_prim(&quot;three&quot;, 1, all_threes)
</pre></div>

<p>This primitive for addition shows how to ask if term <code>t</code> is a
constant via the construct <code>t:is_const()</code>.
</p>
<a name="index-add_002c-primitive"></a>
<div class="example">
<pre class="example">local function add(literal)
   return function(s, v)
             if v then
                return nil
             else
                local x = literal[1]
                local y = literal[2]
                local z = literal[3]
                if y:is_const() and z:is_const() then
                   return {y.id + z.id, y.id, z.id}
                elseif x:is_const() and z:is_const() then
                   return {x.id, x.id - z.id, z.id}
                elseif x:is_const() and y:is_const() then
                   return {x.id, y.id, x.id - y.id}
                else
                   return nil
                end
             end
          end
end
datalog.add_iter_prim(&quot;add&quot;, 3, add)
</pre></div>

<p>The above primitive fails when given a non-numeric argument.  A more
robust implementation of the predicate ensures that arguments are
numbers before performing arithmetic.
</p>
<a name="index-add_002c-primitive-with-type-checking"></a>
<div class="example">
<pre class="example">local function add(literal)
   return function(s, v)
             if v then
                return nil
             else
                local x = literal[1]
                local y = literal[2]
                local z = literal[3]
                if y:is_const() and z:is_const() then
                   local j = tonumber(y.id)
                   local k = tonumber(z.id)
                   if j and k then
                      return {j + k, j, k}
                   else
                      return nil
                   end
                elseif x:is_const() and z:is_const() then
                   local i = tonumber(x.id)
                   local k = tonumber(z.id)
                   if i and k then
                      return {i, i - k, k}
                   else
                      return nil
                   end
                elseif x:is_const() and y:is_const() then
                   local i = tonumber(x.id)
                   local j = tonumber(y.id)
                   if i and j then
                      return {i, j, i - j}
                   else
                      return nil
                   end
                else
                   return nil
                end
             end
          end
end
</pre></div>

<hr>
<a name="Stand_002dAlone"></a>
<div class="header">
<p>
Next: <a href="#Library" accesskey="n" rel="next">Library</a>, Previous: <a href="#Extensions" accesskey="p" rel="prev">Extensions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Stand_002dAlone-1"></a>
<h2 class="chapter">8 Stand-Alone</h2>

<p>The Datalog module can be used by the stand-alone Lua interpreter.
Load it with
</p>
<div class="example">
<pre class="example">require &quot;datalog&quot;
</pre></div>

<p>In the remainder of this chapter, a use of the Datalog module is
demonstrated by translating the following Datalog program into Lua.
</p>
<div class="example">
<pre class="example">q(X) :- p(X).
q(a).
p(X) :- q(X).
q(X)?
</pre></div>

<p>Abbreviations make the code more readable.
</p>
<div class="example">
<pre class="example">mv = datalog.make_var
mc = datalog.make_const
ml = datalog.make_literal
mr = datalog.make_clause
</pre></div>

<p>A translation of <code>q(X) :- p(X).</code>
</p>
<div class="example">
<pre class="example">do
   local head = ml(&quot;q&quot;, {mv(&quot;X&quot;)})
   local body = {ml(&quot;p&quot;, {mv(&quot;X&quot;)})}
   datalog.assert(mr(head, body))
end
</pre></div>

<p>A translation of <code>q(a).</code>
</p>
<div class="example">
<pre class="example">do
   local head = ml(&quot;q&quot;, {mc(&quot;a&quot;)})
   datalog.assert(mr(head, {}))
end
</pre></div>

<p>A translation of <code>p(X) :- q(X).</code>
</p>
<div class="example">
<pre class="example">do
   local head = ml(&quot;p&quot;, {mv(&quot;X&quot;)})
   local body = {ml(&quot;q&quot;, {mv(&quot;X&quot;)})}
   datalog.assert(mr(head, body))
end
</pre></div>

<p>Given a literal, the <code>ask</code> function uses it as a Datalog query
and then prints the answers.
</p>
<a name="index-ask_002c-Lua-function"></a>
<div class="example">
<pre class="example">function ask(literal)
   local ans = datalog.ask(literal)
   if ans then
      for i = 1,#ans do
         io.write(ans.name)
         if ans.arity &gt; 0 then
            io.write(&quot;(&quot;)
            io.write(ans[i][1])
            for j = 2,ans.arity do
               io.write(&quot;, &quot;)
               io.write(ans[i][j])
            end
            io.write(&quot;).\n&quot;)
         else
            io.write(&quot;.\n&quot;)
         end
      end
   end
   return ans
end
</pre></div>

<p>A translation of the query <code>q(X)?</code>
</p>
<div class="example">
<pre class="example">ask(ml(&quot;q&quot;, {mv(&quot;X&quot;)}))
</pre></div>

<p>The answer printed.
</p>
<div class="example">
<pre class="example">q(a).
</pre></div>

<hr>
<a name="Library"></a>
<div class="header">
<p>
Next: <a href="#Copying" accesskey="n" rel="next">Copying</a>, Previous: <a href="#Stand_002dAlone" accesskey="p" rel="prev">Stand-Alone</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Library-1"></a>
<h2 class="chapter">9 Library</h2>

<p>The Datalog library makes the services provided by a Datalog
interpreter available to C programs as a set of C functions and types.
The interface is declared in the header file <samp>datalog.h</samp>.  The
header file contains useful comments.
</p>
<a name="index-dl_005fdb_005ft_002c-library-type"></a>
<p>The state of a Datalog interpreter is maintained by a dynamically
allocated structure.  A pointer to this structure is passed as the
first argument to every C function in the library, except to
<code>dl_open</code>, which allocates the structure, and returns it as a
pointer of type <code>dl_db_t</code>.
</p>
<a name="index-dl_005fopen_002c-library-function"></a>
<div class="example">
<pre class="example">dl_db_t dl_open(void);
</pre></div>

<p>If an error occurs, <code>dl_open</code> returns the null pointer.  To
release the resources associated with a Datalog interpreter, call
<code>dl_close</code>.
</p>
<a name="index-dl_005fclose_002c-library-function"></a>
<div class="example">
<pre class="example">void dl_close(dl_db_t);
</pre></div>

<p>The package name followed by the version number of the library is
returned by <code>dl_version</code>.
</p>
<a name="index-dl_005fversion_002c-library-function"></a>
<div class="example">
<pre class="example">const char* dl_version(void);
</pre></div>

<a name="Asserting"></a>
<h3 class="section">9.1 Asserting</h3>

<p>There are two ways to build literals and clauses, and assert and
retract clauses.  This section describes the low-level interface.  It
builds items by pushing each of its component on a stack, and then
inserting it into the result.  The high-level Datalog program loader
is described later.
</p>
<p>The remaining int returning functions in this interface return zero on
success, unless othewise noted.  The maximum size of the stack
manipulated by the functions is four, but implementations may provide
a larger stack.
</p>
<a name="Strings"></a>
<h4 class="subsection">9.1.1 Strings</h4>

<p>Push a string on the top of the stack.  The string may contain zeros.
</p>
<a name="index-dl_005fpushlstring_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_pushlstring(dl_db_t db, const char *s, size_t n);
</pre></div>

<p>Push a string on the top of the stack.  The string must be zero
terminated.
</p>
<a name="index-dl_005fpushstring_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_pushstring(dl_db_t db, const char *s);
</pre></div>

<p>Concatenate two strings.  Pops two strings off the top of the stack
and then pushes the concatenation of the two strings on the top of the
stack.
</p>
<a name="index-dl_005fconcat_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_concat(dl_db_t db);
</pre></div>

<a name="Literals-1"></a>
<h4 class="subsection">9.1.2 Literals</h4>

<p>Start a literal.  Pushes an incompleted literal on the top of the
stack.
</p>
<a name="index-dl_005fpushliteral_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_pushliteral(dl_db_t db);
</pre></div>

<p>Make a string and then use this to add a predicate symbol to a
literal.  Pops the string from stack.  For each literal, this must be
done once, and can be done after some number of terms have been added.
</p>
<a name="index-dl_005faddpred_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_addpred(dl_db_t db);
</pre></div>

<p>Make a string and then use this to add a variable to the list of terms
of a literal.  Pops the string from stack.
</p>
<a name="index-dl_005faddvar_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_addvar(dl_db_t db);
</pre></div>

<p>Make a string and then use this to add a constant to the list of terms
of a literal.  Pops the string from stack.
</p>
<a name="index-dl_005faddconst_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_addconst(dl_db_t db);
</pre></div>

<p>Finish making a literal after adding all terms and one predicate
   symbol.  Leaves a completed literal on the top of the stack.
</p>
<a name="index-dl_005fmakeliteral_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_makeliteral(dl_db_t db);
</pre></div>

<a name="Clauses-1"></a>
<h4 class="subsection">9.1.3 Clauses</h4>

<p>Make a literal and then use this to start a clause.  Pops a literal
from the stack and leaves a newly created, incomplete clause on top of
the stack.  The head of the clause is the literal.
</p>
<a name="index-dl_005fpushhead_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_pushhead(dl_db_t db);
</pre></div>

<p>Make a literal and then use this to add it to the clause&rsquo;s body.  Pops
a literal from the stack, and inserts it into the incomplete clause on
the top of the stack.
</p>
<a name="index-dl_005faddliteral_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_addliteral(dl_db_t db);
</pre></div>

<p>Finish the clause.  Leaves a completed clause on the top of the stack.
</p>
<a name="index-dl_005fmakeclause_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_makeclause(dl_db_t db);
</pre></div>

<a name="Actions"></a>
<h4 class="subsection">9.1.4 Actions</h4>

<p>Asserts the clause on the top of the stack.  The clause is added to
the database and popped off the stack.  Returns -1 when a clause is
not safe.
</p>
<a name="index-dl_005fassert_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_assert(dl_db_t db);
</pre></div>

<p>Retracts the clause on the top of the stack.  The clause is removed
from the database and popped off the stack.
</p>
<a name="index-dl_005fretract_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_retract(dl_db_t db);
</pre></div>

<a name="Querying"></a>
<h3 class="section">9.2 Querying</h3>

<p>A literal on the stack can be used to query the database.
</p>
<a name="index-dl_005fask_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_ask(dl_db_t db, dl_answers_t *a);
</pre></div>

<a name="index-ground-instance-of-a-literal"></a>
<a name="index-literal_002c-ground-instance"></a>
<p>This function asks for a list that contains all ground instances of a
literal that are a logical consequence of the clauses stored in the
database.  An instance of a literal is <em>ground</em>, if it is the
result of substituting some constant for each variable that occurs in
the literal.  The function always pops the literal from the stack.  If
some answers are found, they are returned by assigning to the <code>a</code>
parameter, a pointer to a freshly allocated list of answers of type
<code>dl_answers_t</code>.  The <code>a</code> parameter is assigned the null
pointer when there are errors or no answers.  The <code>dl_ask</code>
function returns a non-zero value on error.
</p>
<a name="index-dl_005ffree_002c-library-function"></a>
<div class="example">
<pre class="example">void dl_free(dl_answers_t a);
</pre></div>

<p>The <code>dl_free</code> function frees the space associated with a list of
answers.
</p>
<p>A description of the functions that access the components of a list of
answers completes this section.
</p>
<a name="index-dl_005fgetpred_002c-library-function"></a>
<div class="example">
<pre class="example">char *dl_getpred(dl_answers_t a);
</pre></div>

<p>This function gets the predicate symbol associated with the answers.
If the length of the predicate is <var>n</var>, <var>n</var> + 1 character
locations are returned, and the last location is zero.  Other
character locations in the predicate may be zero.  This function
returns the null pointer if given it.
</p>
<a name="index-dl_005fgetpredlen_002c-library-function"></a>
<div class="example">
<pre class="example">size_t dl_getpredlen(dl_answers_t a);
</pre></div>

<p>This function gets the length of the predicate symbol associated with
the answers.  This function returns zero if given the null pointer.
</p>
<a name="index-dl_005fgetpredarity_002c-library-function"></a>
<div class="example">
<pre class="example">size_t dl_getpredarity(dl_answers_t a);
</pre></div>

<p>This function gets the number of terms that makes up each answer.
This number is called the predicate&rsquo;s arity.  It returns zero if given
the null pointer.
</p>
<a name="index-dl_005fgetconst_002c-library-function"></a>
<div class="example">
<pre class="example">char *dl_getconst(dl_answers_t a, int i, int j);
</pre></div>

<p>This function gets the constant associated with term <code>j</code> in
answer <code>i</code>.  Zero-based indexing is used throughout.  If the
length of the constant is <var>n</var>, <var>n</var> + 1 character locations are
returned, and the last location is zero.  Other character locations in
the constant may be zero.  If there is no specified term or no answers
at all, the null pointer is returned.
</p>
<a name="index-dl_005fgetconstlen_002c-library-function"></a>
<div class="example">
<pre class="example">size_t dl_getconstlen(dl_answers_t a, int i, int j);
</pre></div>

<p>This function gets the length of the constant associated with term
<code>j</code> in answer <code>i</code>.  Zero-based indexing is used throughout.
If there is no specified term or no answers at all, zero is returned.
</p>
<a name="Printing"></a>
<h3 class="section">9.3 Printing</h3>

<p>The functions in this section provide support for printing using the
loader&rsquo;s syntax for constants.
</p>
<a name="index-dl_005fputlconst_002c-library-function"></a>
<div class="example">
<pre class="example">void dl_putlconst(FILE *out, const char *s, size_t n);
</pre></div>

<p>Print a constant of a given length.  The function assumes the constant
has <var>n</var> + 1 character locations, and the last location is zero.
Other character locations in the constant may be zero.
</p>
<a name="index-dl_005fputconst_002c-library-function"></a>
<div class="example">
<pre class="example">void dl_putconst(FILE *out, const char *s);
</pre></div>

<p>Print a zero terminated constant.
</p>
<a name="index-dl_005fwidthoflconst_002c-library-function"></a>
<div class="example">
<pre class="example">size_t dl_widthoflconst(const char *s, size_t n);
</pre></div>

<p>Determine the columns needed for a constant with a given length.  The
function assumes the constant has <var>n</var> + 1 character locations, and
the last location is zero.  Other character locations in the constant
may be zero.
</p>
<a name="index-dl_005fwidthofconst_002c-library-function"></a>
<div class="example">
<pre class="example">size_t dl_widthofconst(const char *s);
</pre></div>

<p>Determine the columns needed for a zero terminated constant.
</p>
<a name="Loading"></a>
<h3 class="section">9.4 Loading</h3>

<p>The loader reads a Datalog program.  A program is a sequence of zero
or more assertions or retractions, followed by an optional query
expressed as a literal.  While reading, the loader performs the
assertions and retractions requested by the program.  It finishes by
pushing the query literal on the Datalog interpreter&rsquo;s stack.  If no
query is specified, it pushes a literal known to have no answers.
</p>
<p>The loader obtains buffers containing characters by calling a
function given to it of type <code>dl_reader_t</code>.
</p>
<a name="index-dl_005freader_005ft_002c-library-type"></a>
<div class="example">
<pre class="example">typedef const char *(*dl_reader_t)(void *data, size_t *size);
</pre></div>

<p>When called by the loader, the reader is given the data supplied to
the loader as its first argument.  If there is no more input
available, the reader returns a null pointer, otherwise it assigns the
size of the buffer to the <code>size</code> parameter, and then returns a
pointer to the buffer.
</p>
<p>The loader reports errors by calling a function given to it of type
<code>dl_loaderror_t</code>.
</p>
<a name="index-dl_005floaderror_005ft_002c-library-type"></a>
<div class="example">
<pre class="example">typedef void (*dl_loaderror_t)(void *data, int lineno,
                               int colno, const char *msg);
</pre></div>

<p>When a loader error occurs, the loader calls this function with the
data supplied to the loader, the location of the error as a line
number and column number, and an error message.
</p>
<a name="index-dl_005fload_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_load(dl_db_t database, dl_reader_t reader,
            dl_loaderror_t loaderror, void *data);
</pre></div>

<p>This function loads a Datalog program.  It uses a reader to obtain a
sequence of buffers that contain the program.  The load error reporter
is called when the loader detects an error, and then a non-zero value
is returned, otherwise, the loader returns zero.  The value in the
data parameter is passed to both of the supplied functions whenever
they are called.
</p>
<p>Upon success, the loader leaves a literal on the Datalog interpreter&rsquo;s
stack.  To ignore this literal, call <code>dl_pop</code>.
</p>
<a name="index-dl_005fpop_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_pop(dl_db_t db);
</pre></div>

<p>The <code>dl_loadbuffer</code> function loads a Datalog program contained in
one buffer.
</p>
<a name="index-dl_005floadbuffer_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_loadbuffer(dl_db_t database, const char *buffer,
                  size_t size, dl_loaderror_t loaderror);
</pre></div>

<a name="Stack-Height-Adjusting"></a>
<h3 class="section">9.5 Stack Height Adjusting</h3>

<p>The height of the stack can be saved, and then later reset to the saved
height.  This is useful when errors occur, as it makes it easy to
remove pushed values without keeping track of how many values remain
on the stack.
</p>
<p>The height of the stack is obtained with <code>dl_mark</code>.  For this
function, the return value does not indicate success or failure.
</p>
<a name="index-dl_005fmark_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_mark(dl_db_t db);
</pre></div>

<p>The height of the stack is reset to a value returned by <code>dl_mark</code>
using <code>dl_reset</code>.
</p>
<a name="index-dl_005freset_002c-library-function"></a>
<div class="example">
<pre class="example">int dl_reset(dl_db_t db, int m);
</pre></div>

<hr>
<a name="Copying"></a>
<div class="header">
<p>
Next: <a href="#Index" accesskey="n" rel="next">Index</a>, Previous: <a href="#Library" accesskey="p" rel="prev">Library</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Copying-the-Software"></a>
<h2 class="appendix">Appendix A Copying the Software</h2>

<p>The software described by this manual is covered by the terms of the
GNU Lesser General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any
later version.  The terms are contained in the file <samp>COPYING.LIB</samp>
in the source distribution of the software, or at
<a href="http://www.gnu.org/licenses/lgpl.txt">http://www.gnu.org/licenses/lgpl.txt</a>.
</p>

<hr>
<a name="Index"></a>
<div class="header">
<p>
Previous: <a href="#Copying" accesskey="p" rel="prev">Copying</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Index-1"></a>
<h2 class="unnumbered">Index</h2>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-cp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-add_002c-primitive"><code>add</code>, primitive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-add_002c-primitive-with-type-checking"><code>add</code>, primitive with type checking</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-add_005fiter_005fprim_002c-datalog-function"><code>add_iter_prim</code>, <code>datalog</code> function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ask_002c-Lua-function"><code>ask</code>, Lua function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Stand_002dAlone">Stand-Alone</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-assertion">assertion</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atomic-formula">atomic formula</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-body">body</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-clause">clause</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clause-order_002c-example">clause order, example</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment-syntax">comment syntax</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-constant">constant</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-continuation-line_002c-interpreter">continuation line, interpreter</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-continuation-line_002c-interpreter-1">continuation line, interpreter</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Interpreter">Interpreter</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-datalog_002c-Lua-module"><code>datalog</code>, Lua module</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005faddconst_002c-library-function"><code>dl_addconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005faddliteral_002c-library-function"><code>dl_addliteral</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005faddpred_002c-library-function"><code>dl_addpred</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005faddvar_002c-library-function"><code>dl_addvar</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fask_002c-library-function"><code>dl_ask</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fassert_002c-library-function"><code>dl_assert</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fclose_002c-library-function"><code>dl_close</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fconcat_002c-library-function"><code>dl_concat</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fdb_005ft_002c-library-type"><code>dl_db_t</code>, library type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005ffree_002c-library-function"><code>dl_free</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fgetconst_002c-library-function"><code>dl_getconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fgetconstlen_002c-library-function"><code>dl_getconstlen</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fgetpred_002c-library-function"><code>dl_getpred</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fgetpredarity_002c-library-function"><code>dl_getpredarity</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fgetpredlen_002c-library-function"><code>dl_getpredlen</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fload_002c-library-function"><code>dl_load</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005floadbuffer_002c-library-function"><code>dl_loadbuffer</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005floaderror_005ft_002c-library-type"><code>dl_loaderror_t</code>, library type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fmakeclause_002c-library-function"><code>dl_makeclause</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fmakeliteral_002c-library-function"><code>dl_makeliteral</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fmark_002c-library-function"><code>dl_mark</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fopen_002c-library-function"><code>dl_open</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fpop_002c-library-function"><code>dl_pop</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fpushhead_002c-library-function"><code>dl_pushhead</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fpushliteral_002c-library-function"><code>dl_pushliteral</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fpushlstring_002c-library-function"><code>dl_pushlstring</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fpushstring_002c-library-function"><code>dl_pushstring</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fputconst_002c-library-function"><code>dl_putconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fputlconst_002c-library-function"><code>dl_putlconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005freader_005ft_002c-library-type"><code>dl_reader_t</code>, library type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005freset_002c-library-function"><code>dl_reset</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fretract_002c-library-function"><code>dl_retract</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fversion_002c-library-function"><code>dl_version</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fwidthofconst_002c-library-function"><code>dl_widthofconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dl_005fwidthoflconst_002c-library-function"><code>dl_widthoflconst</code>, library function</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-equals-sign_002c-interpreter">equals sign, interpreter</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Interpreter">Interpreter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-equals-sign_002c-primitive-predicate">equals sign, primitive predicate</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitives">Primitives</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fact">fact</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fact_002c-example">fact, example</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file-loading_002c-interpreter">file loading, interpreter</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Interpreter">Interpreter</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ground-instance-of-a-literal">ground instance of a literal</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-head">head</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-identifiers_002c-token-class">identifiers, token class</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-literal">literal</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-literal_002c-ground-instance">literal, ground instance</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Library">Library</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Lua">Lua</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-predicate-symbol">predicate symbol</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-program">program</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-punctuations_002c-token-class">punctuations, token class</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-Q">Q</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-query">query</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-reader">reader</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-retraction">retraction</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-retraction_002c-example">retraction, example</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rule">rule</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rule_002c-example">rule, example</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-safe">safe</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-strings_002c-token-class">strings, token class</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-tab-separated-values">tab separated values</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Import_002fExport">Import/Export</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-term">term</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-three_002c-primitive"><code>three</code>, primitive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extensions">Extensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-token-classes">token classes</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-variable">variable</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tutorial">Tutorial</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-variables_002c-token-class">variables, token class</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Index_cp_letter-W">W</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-whitespace">whitespace</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax">Syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Index_cp_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>

<hr>



</body>
</html>

